<!--pages/chat/chat.wxml-->
<view class="chat-container">
  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view 
    class="messages-list" 
    scroll-y 
    scroll-into-view="{{scrollIntoView}}"
    enable-back-to-top
  >
    <view class="message-item" 
      wx:for="{{messages}}" 
      wx:key="_id"
      id="msg-{{index}}"
    >
      <!-- å¯¹æ–¹çš„æ¶ˆæ¯ï¼ˆå·¦ä¾§ï¼‰ -->
      <view class="message-left" wx:if="{{item.senderId !== currentUserId}}">
        <image class="avatar" src="{{otherUser.avatarUrl}}" mode="aspectFill"></image>
        <view class="message-content">
          <view class="message-bubble message-bubble-other">
            <text>{{item.content}}</text>
          </view>
          <view class="message-time">{{formatMessageTime(item.createdAt)}}</view>
        </view>
      </view>

      <!-- è‡ªå·±çš„æ¶ˆæ¯ï¼ˆå³ä¾§ï¼‰ -->
      <view class="message-right" wx:else>
        <view class="message-content">
          <view class="message-bubble message-bubble-self">
            <text>{{item.content}}</text>
          </view>
          <view class="message-time">{{formatMessageTime(item.createdAt)}}</view>
        </view>
        <image class="avatar" src="{{item.senderAvatar}}" mode="aspectFill"></image>
      </view>
    </view>

    <!-- åŠ è½½ä¸­æç¤º -->
    <view class="loading-tip" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæç¤º -->
    <view class="no-more-tip" wx:if="{{!hasMore && messages.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šæ¶ˆæ¯äº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{messages.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ’¬</text>
      <text class="empty-text">æš‚æ— æ¶ˆæ¯ï¼Œå¿«æ¥å¼€å§‹å¯¹è¯å§</text>
    </view>
  </scroll-view>

  <!-- è¾“å…¥æ¡† -->
  <view class="input-bar">
    <input 
      class="message-input"
      type="text"
      value="{{inputText}}"
      bindinput="onInputChange"
      placeholder="è¾“å…¥æ¶ˆæ¯..."
      confirm-type="send"
      bindconfirm="sendMessage"
    />
    <button 
      class="send-btn" 
      bindtap="sendMessage"
      disabled="{{!inputText.trim()}}"
    >
      å‘é€
    </button>
  </view>
</view>
