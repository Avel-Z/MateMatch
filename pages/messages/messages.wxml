<!--pages/messages/messages.wxml-->
<view class="container">
  <!-- ä¼šè¯åˆ—è¡¨ -->
  <view class="conversations-list" wx:if="{{conversations.length > 0}}">
    <view 
      class="conversation-item" 
      wx:for="{{conversations}}" 
      wx:key="_id"
      bindtap="enterChat"
      data-conversation="{{item}}"
    >
      <view class="avatar-wrapper">
        <image class="avatar" src="{{item.otherUserAvatar}}" mode="aspectFill"></image>
        <view class="unread-badge" wx:if="{{item.unreadCount > 0}}">
          <text>{{item.unreadCount > 99 ? '99+' : item.unreadCount}}</text>
        </view>
      </view>
      
      <view class="conversation-content">
        <view class="top-row">
          <text class="name">{{item.otherUserName}}</text>
          <text class="time">{{formatTime(item.lastMessageTime)}}</text>
        </view>
        <view class="bottom-row">
          <text class="last-message">{{item.lastMessage || 'å¼€å§‹å¯¹è¯'}}</text>
          <view class="post-tag" wx:if="{{item.postTitle}}">
            <text>{{item.postTitle}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{conversations.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ’¬</text>
    <text class="empty-title">æš‚æ— æ¶ˆæ¯</text>
    <text class="empty-desc">åœ¨å¸–å­è¯¦æƒ…é¡µå‘èµ·å¯¹è¯åï¼Œæ¶ˆæ¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
  </view>
</view>
